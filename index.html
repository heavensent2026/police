<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PULSE: MASTER DECK</title>
    <style>
        :root { --danger: #ff4757; --safe: #2ed573; --bg: #050505; --card: #121212; --accent: #3498db; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { background: #000; padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .score { font-family: monospace; color: var(--accent); font-weight: bold; font-size: 1.2rem; }
        .meters-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; background: #0a0a0a; border-bottom: 2px solid #1a1a1a; }
        .meter-container { display: flex; flex-direction: column; gap: 4px; }
        .meter-label { font-size: 0.55rem; text-transform: uppercase; color: #666; font-weight: 800; }
        .meter-track { height: 6px; background: #1a1a1a; border-radius: 3px; overflow: hidden; }
        .meter-fill { height: 100%; width: 100%; transition: width 0.4s ease, background 0.3s; }
        .stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 25px; text-align: center; }
        .card-frame { background: var(--card); width: 100%; max-width: 400px; min-height: 320px; border-radius: 16px; border: 1px solid #252525; padding: 30px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; }
        .card-frame.CRISIS { border: 2px solid var(--danger); box-shadow: 0 0 40px rgba(255, 71, 87, 0.2); }
        .card-flavor { font-size: 1.15rem; color: #eee; line-height: 1.5; font-weight: 500; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 20px 20px 40px 20px; background: #000; min-height: 140px; }
        button { padding: 18px; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; color: #fff; }
        .btn-l { background: #1a1a1a; border: 1px solid #333; }
        .btn-r { background: var(--accent); color: #000; }
        .full-btn { grid-column: span 2; background: var(--accent); color: #000; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: 900; font-size: 0.65rem; color: #444; letter-spacing: 2px;">PULSE: FULL_COLLECTION_500</div>
    <div class="score" id="score">000000</div>
</div>

<div class="meters-grid">
    <div class="meter-container"><span class="meter-label">Family</span><div class="meter-track"><div id="m-fam" class="meter-fill" style="width:100%"></div></div></div>
    <div class="meter-container"><span class="meter-label">Dept</span><div class="meter-track"><div id="m-dep" class="meter-fill" style="width:100%"></div></div></div>
    <div class="meter-container"><span class="meter-label">Health</span><div class="meter-track"><div id="m-hea" class="meter-fill" style="width:100%"></div></div></div>
    <div class="meter-container"><span class="meter-label">Public</span><div class="meter-track"><div id="m-pub" class="meter-fill" style="width:100%"></div></div></div>
</div>

<div class="stage">
    <div id="card-display" class="card-frame">
        <p class="card-flavor" id="card-desc">Compiling Project Data... All threads synced.</p>
    </div>
</div>

<div class="controls" id="control-panel">
    <button class="full-btn" onclick="initGame()">START SHIFT</button>
</div>

<script>
// --- THE FULL PROJECT DATA POOL ---
const STORY_THREADS = [
    { n: "THE HEART RUN", p: [["Courier stuck in rain.", "Police Escort", "Reroute"], ["Fridge power low.", "Swap Cell", "Voltage Mod"]], c: [["Organ failure imminent!", "Direct Inject", "Ice Bath"]] },
    { n: "IA MOLE", p: [["Suspicious login found.", "Bait Port", "Kill Link"], ["IA asking for logs.", "Comply", "Question"]], c: [["GRID BLACKOUT: Mole active!", "Manual Reset", "Detain Mole"]] },
    { n: "THE GREAT FLOOD", p: [["Levee wall vibrating.", "Sandbag", "Reinforce"], ["Sump pump jam.", "Clear Debris", "Manual Crank"]], c: [["LEVEE BREACH: Sector 4 lost!", "Seal Zone", "Evacuate"]] },
    { n: "THE ROOKIE", p: [["Rookie hesitating.", "Coach Him", "Reprimand"], ["Rookie made a typo.", "Correct it", "Ignore"]], c: [["ROOKIE PANIC: Safety off!", "Disarm Him", "Calm Down"]] },
    { n: "THE STATE FAIR", p: [["Crowd pushing gates.", "More Guard", "Close Gate"], ["Minor fight near rides.", "Send Squad", "Watch Only"]], c: [["STAMPEDE: Panic in plaza!", "Sound Alarm", "Open All Gates"]] }
];

const REGULAR_PULSE = [
    {d: "Coffee machine broke. Team is angry.", l: "Fix It", r: "Ignore"},
    {d: "Overtime request on your desk.", l: "Approve", r: "Deny"},
    {d: "Spouse: 'The sink is leaking.'", l: "Call Help", r: "Guide Home"},
    {d: "Light flicker in Sector 1.", l: "Check Fuse", r: "Disregard"},
    {d: "Admin error in the weekly logs.", l: "Recalibrate", r: "Sign Off"}
];

let decks = { P_Random: [], P_Story: [], C_Story: [], active: false };
let game = { fam: 100, dep: 100, hea: 100, pub: 100, lapse: 0, score: 0, turn: 0 };

function build500() {
    // 150 Random Regular Pulse
    for(let i=0; i<150; i++) decks.P_Random.push(REGULAR_PULSE[i % REGULAR_PULSE.length]);
    // 150 Sequential Story Pulse
    for(let i=0; i<150; i++) {
        let t = STORY_THREADS[i % STORY_THREADS.length];
        let b = t.p[Math.floor(i / STORY_THREADS.length) % t.p.length];
        decks.P_Story.push({d: `${t.n}: ${b[0]}`, l: b[1], r: b[2]});
    }
    // 200 Sequential Crisis
    for(let i=0; i<200; i++) {
        let t = STORY_THREADS[i % STORY_THREADS.length];
        let b = t.c[Math.floor(i / STORY_THREADS.length) % t.c.length];
        decks.C_Story.push({d: `CRITICAL ${t.n}: ${b[0]}`, l: b[1], r: b[2]});
    }
}

function initGame() {
    build500();
    decks.active = true;
    document.getElementById('control-panel').innerHTML = `
        <button id="btn-left" class="btn-l" onclick="step('L')"></button>
        <button id="btn-right" class="btn-r" onclick="step('R')"></button>
    `;
    step('INIT');
}

function step(choice) {
    if (!decks.active) return;

    if (choice === 'L') {
        game.lapse += (9 + (game.turn * 0.12));
        game.fam = Math.min(100, game.fam + 2);
        game.hea -= 2;
    } else if (choice === 'R') {
        game.lapse = Math.max(0, game.lapse - 20);
        game.dep -= 5;
        game.pub -= 4;
        game.hea -= 4;
    }

    let card;
    let isC = (Math.random() * 100 < game.lapse && decks.C_Story.length > 0);

    if (isC) {
        card = decks.C_Story.shift();
        game.lapse = 0;
    } else {
        // Decide between Random Pulse or Story Pulse
        if (Math.random() > 0.4 && decks.P_Random.length > 0) {
            let idx = Math.floor(Math.random() * decks.P_Random.length);
            card = decks.P_Random.splice(idx, 1)[0];
        } else {
            card = decks.P_Story.shift() || {d: "Shift Over.", l: "End", r: "End"};
        }
    }

    const mult = isC ? 25 : 6;
    game.fam -= Math.random() * mult; game.dep -= Math.random() * mult;
    game.hea -= Math.random() * mult; game.pub -= Math.random() * mult;

    if (choice !== 'INIT') { game.turn++; game.score += 100; }
    render(card, isC);
}

function render(card, isC) {
    document.getElementById('card-desc').innerText = card.d;
    document.getElementById('btn-left').innerText = card.l;
    document.getElementById('btn-right').innerText = card.r;
    document.getElementById('card-display').className = isC ? "card-frame CRISIS" : "card-frame";
    document.getElementById('score').innerText = game.score.toString().padStart(6, '0');
    
    ['fam', 'dep', 'hea', 'pub'].forEach(k => {
        let v = Math.max(0, game[k]);
        let el = document.getElementById('m-' + k);
        el.style.width = v + "%";
        el.style.background = v < 30 ? "var(--danger)" : (v < 60 ? "#f1c40f" : "var(--safe)");
    });

    if (game.fam <= 0 || game.dep <= 0 || game.hea <= 0 || game.pub <= 0) {
        decks.active = false;
        document.getElementById('card-desc').innerText = "FATAL STABILITY FAILURE.";
        document.getElementById('control-panel').innerHTML = `<button class="full-btn" onclick="location.reload()">RESTART</button>`;
    }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Troop 6: Legacy Pro</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJubWUiOiAiVHJvb3AgNjogTGVnYWN5IiwKICAic2hvcnRfbmFtZSI6ICJUcm9vcGVyIiwKICAic3RhcnRfdXJsIjogIi4vdHJvb3Blcl9maW5hbC5odG1sIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMDIwYzFiIiwKICAidGhlbWVfY29sb3IiOiAiIzVjYTA1OSIsCiAgImljb25zIjogWwogICAgeyAic3JjIjogImh0dHBzOi8vY2RuLWljb25zLXBuZy5mbGF0aWNvbi5jb20vNTEyLzI1NTUvMjU1NTAxMy5wbmciLCAic2l6ZXMiOiAiNTEyeDUxMiIsICJ0eXBlIjogImltYWdlL3BuZyIgfQogIF0KfQ==">
    <style>
        :root { --blue: #020c1b; --gold: #c5a059; --red: #ff4d4d; --green: #50fa7b; --text: #e6f1ff; --card-bg: #112240; }
        body { background: var(--blue); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; touch-action: none; }
        #header { padding: 12px; background: #0a192f; border-bottom: 2px solid var(--gold); }
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 5px; }
        .bar-wrap { background: #233554; height: 6px; border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; width: 50%; transition: width 0.4s ease; }
        .stat-label { font-size: 8px; text-align: center; margin-top: 3px; text-transform: uppercase; color: #8892b0; }
        #event-banner { background: var(--red); color: white; font-size: 10px; text-align: center; font-weight: bold; padding: 4px; display: none; }
        #game { flex-grow: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        #card { width: 90vw; max-width: 360px; height: 480px; background: var(--card-bg); border-radius: 20px; border: 1px solid var(--gold); padding: 25px; box-sizing: border-box; box-shadow: 0 20px 50px rgba(0,0,0,0.8); position: relative; transition: transform 0.1s; }
        #swipe-indicator { position: absolute; top: 10px; width: 100%; text-align: center; font-weight: bold; font-size: 12px; height: 20px; }
        #card-icon { font-size: 45px; text-align: center; margin-bottom: 15px; }
        #card-title { font-size: 18px; color: var(--gold); margin: 0; }
        #card-desc { font-size: 15px; color: #8892b0; line-height: 1.5; margin-top: 15px; }
        #nav { display: flex; background: #0a192f; border-top: 1px solid #233554; }
        .nav-btn { flex: 1; padding: 15px; text-align: center; font-size: 12px; color: #8892b0; cursor: pointer; }
        .nav-btn.active { color: var(--gold); border-top: 2px solid var(--gold); }
        #locker { display: none; padding: 20px; overflow-y: auto; height: 100%; box-sizing: border-box; }
        .shop-item { background: #112240; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #233554; display: flex; justify-content: space-between; align-items: center; }
        .buy-btn { background: var(--gold); color: var(--blue); border: none; padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 12px; }
        .buy-btn.owned { background: #233554; color: #8892b0; }
        #overlay { display: none; position: fixed; inset: 0; background: var(--blue); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div id="event-banner">TRAFFIC ALERT</div>
<div id="header">
    <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--gold)">
        <span id="rank-name">ROOKIE</span><span id="xp-display">XP: 0</span>
    </div>
    <div class="stat-grid">
        <div><div class="bar-wrap"><div id="f-bar" class="bar-fill" style="background:var(--red)"></div></div><div class="stat-label">FAM</div></div>
        <div><div class="bar-wrap"><div id="d-bar" class="bar-fill" style="background:var(--gold)"></div></div><div class="stat-label">DEP</div></div>
        <div><div class="bar-wrap"><div id="p-bar" class="bar-fill" style="background:var(--green)"></div></div><div class="stat-label">PUB</div></div>
        <div><div class="bar-wrap"><div id="h-bar" class="bar-fill" style="background:white"></div></div><div class="stat-label">HLT</div></div>
    </div>
</div>

<div id="main-view" style="flex-grow:1; display:flex; flex-direction:column;">
    <div id="game">
        <div id="card">
            <div id="swipe-indicator"></div>
            <div id="card-icon">ðŸš“</div>
            <h2 id="card-title">Radio Check</h2>
            <p id="card-desc">Your career begins in Troop 6. Swipe to respond.</p>
        </div>
    </div>
    <div id="locker">
        <h2 style="color:var(--gold)">Troop 6 Locker</h2>
        <div id="shop-list"></div>
    </div>
</div>

<div id="nav">
    <div class="nav-btn active" onclick="showTab('game')">PATROL</div>
    <div class="nav-btn" onclick="showTab('locker')">LOCKER</div>
</div>

<div id="overlay">
    <h1 id="over-title">END OF WATCH</h1>
    <p id="over-msg"></p>
    <button onclick="location.reload()" style="background:var(--gold); padding:10px 20px; border:none; border-radius:5px; font-weight:bold;">RE-ENLIST</button>
</div>

<script>
    const DECKS = {
        INTERCEPTOR: [
            { t: "Speeding [Vehicle]", d: "Doing [Speed] MPH near [Location]. Traffic is heavy.", i: "ðŸŽï¸", l: "Cite", r: "Warn", lf:{d:10, p:-5, h:-5}, rf:{d:-10, p:10, h:5} },
            { t: "DUI Stop", d: "Driver in [Vehicle] smells of [Odor]. Eyes are bloodshot.", i: "ðŸ¥ƒ", l: "Arrest", r: "Call Ride", lf:{d:15, p:-5, h:-10}, rf:{p:15, d:-15, h:5} },
            { t: "Sovereign Citizen", d: "Driver of [Vehicle] claims they don't need a license to 'travel'.", i: "ðŸ“œ", l: "Extract", r: "De-escalate", lf:{d:15, p:-20, h:-10}, rf:{d:-10, p:10, h:5} },
            { t: "The Weaver", d: "Dark [Vehicle] weaving through traffic on [Location].", i: "ðŸŽï¸", l: "Stop", r: "Observe", lf:{d:10, p:5, h:-5}, rf:{d:0, p:0, h:0} }
        ],
        RARE: [
            { t: "K9 Alert", d: "Your K9 is scratching at the wheel well of a [Vehicle].", i: "ðŸ•", l: "Full Search", r: "Dismiss", lf:{d:25, p:-20, h:-5}, rf:{d:-15, p:10} },
            { t: "PIT Maneuver", d: "The [Vehicle] is fleeing toward a school. Clear to PIT?", i: "ðŸŽï¸", l: "Execute", r: "Abort", lf:{d:20, h:-40, p:10}, rf:{d:-15, p:-20, h:10} },
            { t: "Felony Stop", d: "[Vehicle] is flagged as stolen. Driver is reaching.", i: "ðŸ”«", l: "Draw Duty Weapon", r: "Wait for Backup", lf:{d:15, h:-30, p:-5}, rf:{d:-5, h:0, p:10} },
            { t: "Radiator Blow", d: "Steam pouring from your cruiser during a high-speed chase.", i: "ðŸ’¨", l: "Keep Driving", r: "Stop & Call", lf:{d:10, h:-35}, rf:{d:-20, h:10} },
            { t: "Bodycam Fail", d: "You realize your cam was off during a major search.", i: "ðŸ“·", l: "Self-Report", r: "Stay Quiet", lf:{d:10, p:10, h:-15}, rf:{d:-40, p:-10} },
            { t: "Suppression Hearing", d: "Defense is trying to toss your evidence in court.", i: "ðŸ›ï¸", l: "Fight Case", r: "Defer", lf:{d:15, h:-10}, rf:{d:-15, p:5} },
            { t: "Active Shooter", d: "Dispatch reports shots fired at a rest stop on [Location].", i: "ðŸ›‘", l: "Entry", r: "Perimeter", lf:{p:40, h:-50, d:20}, rf:{d:10, h:-5, p:-20} },
            { t: "Bridge Jumper", d: "Subject on the ledge of [Location]. You are first on scene.", i: "ðŸŒ‰", l: "Negotiate", r: "Hold Traffic", lf:{p:30, h:-20}, rf:{p:5, d:10} },
            { t: "Corruption Offer", d: "Driver offers $5k to let them walk away from a DUI.", i: "ðŸ’°", l: "Add Bribery Charge", r: "Look Away", lf:{d:30, p:10}, rf:{d:-50, p:-10, f:20} },
            { t: "Amber Alert", d: "[Vehicle] matches the description of a child abduction.", i: "ðŸš¨", l: "Force Stop", r: "Verify Plate", lf:{p:40, h:-20, d:20}, rf:{p:10, d:5} }
            // Logic effectively cycles these as "True Rarity"
        ],
        LIFE: [
            { t: "Anniversary", d: "It's your 10th anniversary, but shift is short-staffed.", i: "ðŸ’", l: "Work OT", r: "Go Home", lf:{d:15, f:-30}, rf:{f:25, d:-20} },
            { t: "Sick Kid", d: "Child has a 103 fever. Spouse needs help.", i: "ðŸ¤’", l: "Stay", r: "Leave", lf:{d:10, f:-35}, rf:{f:30, d:-25} },
            { t: "Academy Offer", d: "Promoted to FTO. Less time on the road.", i: "ðŸŽ“", l: "Accept", r: "Decline", lf:{h:20, f:15, d:5}, rf:{h:-15, d:20} }
        ]
    };

    const SHOP = [
        { id: 'slicktop', name: 'Slicktop Charger', desc: '-50% Public penalty for tickets.', cost: 500 },
        { id: 'k9', name: 'K9 Partner', desc: '+25% Department gains.', cost: 1200 },
        { id: 'vest', name: 'Advanced Armor', desc: '-30% Health loss in chases.', cost: 800 },
        { id: 'coffee', name: 'Premium Coffee', desc: '+2 Health every swipe.', cost: 300 }
    ];

    let state = JSON.parse(localStorage.getItem('trooper_gold')) || { f:50, d:50, p:50, h:50, xp:0, owned: [], eventTimer: 0, activeEventIndex: 0 };
    let startX = 0; const card = document.getElementById('card'); const indicator = document.getElementById('swipe-indicator');

    function save() { localStorage.setItem('trooper_gold', JSON.stringify(state)); }

    function updateUI() {
        ['f','d','p','h'].forEach(s => document.getElementById(s+'-bar').style.width = state[s]+'%');
        document.getElementById('xp-display').innerText = `XP: ${state.xp}`;
        document.getElementById('rank-name').innerText = state.xp > 3000 ? "SERGEANT" : (state.xp > 1000 ? "CORPORAL" : "ROOKIE");
        if(state.f<=0 || state.d<=0 || state.p<=0 || state.h<=0) {
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('over-msg').innerText = "Career Over.";
            localStorage.clear();
        }
        renderShop();
    }

    function showTab(tab) {
        document.getElementById('game').style.display = tab === 'game' ? 'flex' : 'none';
        document.getElementById('locker').style.display = tab === 'locker' ? 'block' : 'none';
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function renderShop() {
        const list = document.getElementById('shop-list');
        list.innerHTML = SHOP.map(item => `
            <div class="shop-item">
                <div style="flex:1"><h3>${item.name}</h3><p>${item.desc}</p><p style="color:var(--gold)">${item.cost} XP</p></div>
                <button class="buy-btn ${state.owned.includes(item.id) ? 'owned' : ''}" onclick="buyItem('${item.id}', ${item.cost})">${state.owned.includes(item.id) ? 'OWNED' : 'BUY'}</button>
            </div>`).join('');
    }

    function buyItem(id, cost) {
        if (state.xp >= cost && !state.owned.includes(id)) { state.xp -= cost; state.owned.push(id); save(); updateUI(); }
    }

    function getCard() {
        let pool = DECKS.INTERCEPTOR; 
        let roll = Math.random();
        if (roll > 0.9) pool = DECKS.RARE; // True Rare Chance
        else if (roll > 0.75) pool = DECKS.LIFE;

        const c = pool[Math.floor(Math.random()*pool.length)];
        const vars = { "[Vehicle]": ["Mustang", "F-150", "Semi", "Charger", "Altima"], "[Speed]": ["104","115","98"], "[Odor]": ["Alcohol", "Marijuana"], "[Location]": ["I-26", "Ravenel Bridge", "17-A", "Crosstown"] };
        let title = c.t; let desc = c.d;
        for(let k in vars) {
            let val = vars[k][Math.floor(Math.random()*vars[k].length)];
            title = title.split(k).join(val); desc = desc.split(k).join(val);
        }
        document.getElementById('card-title').innerText = title;
        document.getElementById('card-desc').innerText = desc;
        document.getElementById('card-icon').innerText = c.i;
        card.dataset.l = JSON.stringify(c.lf); card.dataset.r = JSON.stringify(c.rf);
        card.dataset.lt = c.l; card.dataset.rt = c.r;
        card.style.transform = `translateX(0) rotate(0)`; card.style.opacity = 1; indicator.innerText = "";
    }

    card.addEventListener('touchstart', e => { startX = e.touches[0].clientX; card.style.transition = 'none'; });
    card.addEventListener('touchmove', e => {
        let x = e.touches[0].clientX - startX;
        card.style.transform = `translateX(${x}px) rotate(${x/20}deg)`;
        indicator.innerText = x < -50 ? card.dataset.lt : (x > 50 ? card.dataset.rt : "");
        indicator.style.color = x < 0 ? "var(--red)" : "var(--green)";
    });
    card.addEventListener('touchend', e => {
        card.style.transition = '0.3s';
        let x = e.changedTouches[0].clientX - startX;
        if (Math.abs(x) > 120) {
            const effect = JSON.parse(x < 0 ? card.dataset.l : card.dataset.r);
            for(let s in effect) {
                let val = effect[s];
                if(s === 'p' && val < 0 && state.owned.includes('slicktop')) val *= 0.5;
                if(s === 'd' && val > 0 && state.owned.includes('k9')) val *= 1.25;
                if(s === 'h' && val < 0 && state.owned.includes('vest')) val *= 0.7;
                state[s] = Math.min(100, Math.max(0, state[s] + val));
            }
            if(state.owned.includes('coffee')) state.h = Math.min(100, state.h + 1);
            state.xp += 50; save(); updateUI();
            card.style.opacity = 0; setTimeout(getCard, 300);
        } else { card.style.transform = 'translateX(0) rotate(0)'; indicator.innerText = ""; }
    });

    updateUI(); getCard();
</script>
</body>
</html>
